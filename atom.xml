<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[(elegant coding from a more civilized age)]]></title>
  <link href="http://AlexBaranosky.github.io/atom.xml" rel="self"/>
  <link href="http://AlexBaranosky.github.io/"/>
  <updated>2013-10-27T01:08:20-07:00</updated>
  <id>http://AlexBaranosky.github.io/</id>
  <author>
    <name><![CDATA[Alex Baranosky]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[A Mathematical Jaunt Via San Mateo Parking Meters]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2013/08/17/a-mathematical-jaunt-via-san-mateo/"/>
    <updated>2013-08-17T13:37:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2013/08/17/a-mathematical-jaunt-via-san-mateo</id>
    <content type="html"><![CDATA[<p>Theeee other day some colleagues and I drove into downtown San Mateo for lunch.  An interesting decision had to be made: how many quarters to pay the meter.</p>

<p>The price for parking is $0.25 per half hour. Your penny-pinching instincts suggest to only put in 2 quarters.  Let&rsquo;s say that a parking ticket for going over the meter is $40.</p>

<h1>Breaking Down the Scenario</h1>

<p>Let&rsquo;s apply a little reasoning and mathematics to this, situation and see what&rsquo;s the right amount of quarters to put into the meter.</p>

<p>There are 5 possible outcomes:</p>

<ol>
<li>pay $0.50, go under one hour, no ticket: total price $0.50</li>
<li>pay $0.50, go over one hour, no ticket: total price $0.50</li>
<li>pay $0.50, go over one hour, get ticket: total price $40.50</li>
<li>pay $0.75, go under one hour, no ticket: total price $0.75</li>
<li>pay $0.75, go over one hour, no ticket: total price $0.75</li>
</ol>


<h1>Conservative Guesstimates</h1>

<p>Now the fun part.  Let&rsquo;s assign rough guesstimates of likelihood for each outcome.</p>

<p>Let&rsquo;s be generous and say that you only go over one hour 20% of the time, and only 20% of the times you go over do you get a ticket.</p>

<p>Let&rsquo;s also say that you pay $0.50 half the time and $0.75 half the time.</p>

<ol>
<li>40% probability x $0.50 = $0.20</li>
<li>8% probability x $0.50 = $0.04</li>
<li>2% probability x $40.50 = $0.81</li>
<li>40% probability x $0.75 = $0.30</li>
<li>10% probability x $0.75 = $0.075</li>
</ol>


<p>Computed average cost: $1.425</p>

<p>Even at the conservative rate of ticketing of 20% of time you go over an hour, you still increase your expected rate of pay to almost double, by choosing to pay $0.50 half the time!</p>

<h1>With Vigilant Meter Maids</h1>

<p>If instead you think you&rsquo;ll get a ticket 75% of the time you go over, the average cost per park becomes a whopping $3.625</p>

<ol>
<li>40% probability x $0.50 = $0.20</li>
<li>2.5% probability x $0.50 = $0.0125</li>
<li>7.5% probability x $40.50 = $3.0375</li>
<li>40% probability x $0.75 = $0.30</li>
<li>10% probability x $0.75 = $0.075</li>
</ol>


<p>Computed average cost: $3.625</p>

<p>So it looks like in general it pays to be safe and pay the extra quarter when parking in downtown San Mateo.</p>

<h1>Further Precision</h1>

<p>We could expand this further, by considering likelihoods of lunch going over 1.5 hours.  I didn&rsquo;t because I think there&rsquo;s diminishing returns on investment because the odds of going over 1.5 hours are probably only like 20% of 20% => 4%&hellip;  I&rsquo;ll leave that as an exercise for the reader :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[IO as Data]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2013/08/08/io-as-data/"/>
    <updated>2013-08-08T23:51:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2013/08/08/io-as-data</id>
    <content type="html"><![CDATA[<p>One way to make your Clojure code easier to test and to reason about is to quarantine your IO.  Amongst your team decide where you think the acceptable boundaries for IO are, and then don&rsquo;t do any IO except in those layers.  In my opinion the place to do IO is in the service layer, as described in Amit Rathore&rsquo;s talk at Clojure/West, <a href="http://www.infoq.com/presentations/DDD-Clojure">Domain-Driven Design With Clojure</a>.</p>

<p>What this can lead to is code patterned where instead of executing IO straight away, you instead compute IO IOUs: a pure function determines that some piece of IO should occur, and returns that fact encoded in some form of data.</p>

<h1>A Basic Example</h1>

<p>Say we have a map that tracks the inventory changes at a warehouse.  It typically looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">an-example-inventory</span>
</span><span class='line'>  <span class="p">{</span><span class="ss">:items</span> <span class="p">{</span><span class="mi">12345</span>
</span><span class='line'>           <span class="p">{</span><span class="ss">:product-id</span> <span class="mi">12345</span>
</span><span class='line'>            <span class="ss">:product-name</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>            <span class="ss">:quantity</span> <span class="mi">300</span>
</span><span class='line'>            <span class="c1">;; ...</span>
</span><span class='line'>            <span class="p">}}</span>
</span><span class='line'>   <span class="ss">:actions</span> <span class="p">{</span><span class="ss">:order-from-factory</span> <span class="p">[]}})</span> <span class="c1">;; this is where the IO data goes</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">remove-item-from-inventory</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">inventory</span> <span class="p">{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">product-id</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">item</span><span class="p">}]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">some-&gt;</span> <span class="nv">inventory</span> <span class="ss">:items</span> <span class="nv">product-id</span> <span class="ss">:quantity</span> <span class="nb">count </span><span class="p">(</span><span class="nb">&gt; </span><span class="mi">0</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">update-in</span> <span class="nv">inventory</span> <span class="p">[</span><span class="ss">:items</span> <span class="nv">product-id</span> <span class="ss">:quantity</span><span class="p">]</span> <span class="nv">dec</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">update-in</span> <span class="nv">inventory</span> <span class="p">[</span><span class="ss">:actions</span> <span class="ss">:order-from-factory</span><span class="p">]</span> <span class="nb">conj </span><span class="nv">product-id</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Then at a later stage of processing this code, at an outer layer that deals with IO, we can look over the actions on the inventory map and processes them accordingly.</p>

<h1>Ramifications of This Style</h1>

<p>A cool side effect of this is that if you want to change how your IO gets evaluated it will all be in a handful of well-defined places.  This makes switching out implementation details easier.  Also, it makes converting to asynchronous IO more straightforward if the IO becomes a blocker to the performance of the system.</p>

<p>Your code becomes less coupled to implementation details of your IO, and instead talks more about the computed intended effects. Unit testability of the system goes up, because everything except the service layer, is just pure functions and data.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Evolution of a Macro]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2013/07/28/the-evolution-of-macro/"/>
    <updated>2013-07-28T02:59:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2013/07/28/the-evolution-of-macro</id>
    <content type="html"><![CDATA[<p>At Runa, where I work, I work on a very large Clojure application which we service online merchants with in order to deliver real-time promotions to the browser. The runtime promotion determination core of the application is quite intricate and has both stateful and immutable parts. If not tested properly, you can make the mistake of letting any setup mutable state effect tests other than the intended test case.</p>

<p>I thought it&rsquo;d be fun to walk you through how I developed a macro to handle this type of situation at work. I think it is a pretty interesting example of how macros can evolve and what considerations might go into how you architect a meaty macro.</p>

<p><em>NOTE: The code has been simplified from the production code to better emphasize the important points.</em></p>

<h3>First Stab At a Stateful Test Macro</h3>

<p>Our first stab at this problem solves the basic initial version of the problem. Often this would be all you need to get the job done. This approach enables us to evaluate our test assertion from within a stateful scope, and we use the finally block of the try-catch to ensure that the rules are always set back to their original state when the test is done.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-rules</span> <span class="p">[</span><span class="nv">rules</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'>  <span class="o">`</span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">old-rules#</span> <span class="err">@</span><span class="nv">rules</span><span class="p">]</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">reset!</span> <span class="nv">rules</span> <span class="p">(</span><span class="nf">evaluate-rules</span> <span class="o">~</span><span class="nv">rules</span><span class="p">))</span>
</span><span class='line'>       <span class="o">~@</span><span class="nv">body</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">reset!</span> <span class="nv">rules</span> <span class="nv">old-rules#</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">test-priority-level</span>
</span><span class='line'> <span class="p">(</span><span class="nf">with-rules</span> <span class="p">(</span><span class="nf">def-rule</span> <span class="nv">priority-level</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="nv">true</span> <span class="p">(</span><span class="nf">priority-level</span> <span class="mi">5</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then if we have some other sort of state, for example machine learning models, we can write another <code>with-models</code> macro and combine the macros in a test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-models</span> <span class="p">[</span><span class="nv">models</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'> <span class="o">`</span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">old-models#</span> <span class="err">@</span><span class="nv">models</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">reset!</span> <span class="nv">models</span> <span class="o">~</span><span class="nv">models</span><span class="p">)</span>
</span><span class='line'>   <span class="o">~@</span><span class="nv">body</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">reset!</span> <span class="nv">models</span> <span class="nv">old-models#</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">test-model-and-level</span>
</span><span class='line'> <span class="p">(</span><span class="nf">with-rules</span> <span class="p">(</span><span class="nf">def-rule</span> <span class="nv">priority-level</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">with-models</span> <span class="p">{</span><span class="ss">:a</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">]</span>
</span><span class='line'>                <span class="ss">:b</span> <span class="p">[</span><span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span><span class="p">]}</span> <span class="c1">;; insert fancy math stuff here ;)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="nv">true</span> <span class="p">(</span><span class="nf">found-promotion?</span> <span class="p">(</span><span class="nf">legal-customer-session</span><span class="p">)))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before I make a serious change to the approach we use for this kind of macro, let&rsquo;s remove the bloat from these macros and make them lean mean macros with beefier functions to go with them.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">with-rules*</span> <span class="p">[</span><span class="nv">rules</span> <span class="nv">body-fn</span><span class="p">]</span>
</span><span class='line'> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">old-rules</span> <span class="err">@</span><span class="nv">rules</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">reset!</span> <span class="nv">rules</span> <span class="p">(</span><span class="nf">evaluate-rules</span> <span class="nv">rules</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">body-fn</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">reset!</span> <span class="nv">rules</span> <span class="nv">old-rules</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-rules</span> <span class="p">[</span><span class="nv">rules</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'> <span class="o">`</span><span class="p">(</span><span class="nf">with-rules*</span> <span class="o">~</span><span class="nv">rules</span> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="o">~@</span><span class="nv">body</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">with-models*</span> <span class="p">[</span><span class="nv">models</span> <span class="nv">body-fn</span><span class="p">]</span>
</span><span class='line'> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">old-models</span> <span class="err">@</span><span class="nv">models</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">reset!</span> <span class="nv">models</span> <span class="nv">models</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">body-fn</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">reset!</span> <span class="nv">models</span> <span class="nv">old-models</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-models</span> <span class="p">[</span><span class="nv">models</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'> <span class="o">`</span><span class="p">(</span><span class="nf">with-models*</span> <span class="o">~</span><span class="nv">models</span> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="o">~@</span><span class="nv">body</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Why? Because macros are harder to read, and not composable.</p>

<p>This way of approaching the stateful setup and teardown in our tests gets the
job done, but has a couple issues. As soon as we have another source of state we
need another with-x macro, and when we combine these together we end up over
time with code that looks like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">test-motherload</span>
</span><span class='line'> <span class="p">(</span><span class="nf">with-x</span> <span class="nv">X</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">with-y</span> <span class="nv">Y</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">with-z</span> <span class="nv">Z</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">with-a</span> <span class="nv">A</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">with-b</span> <span class="nv">B</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="mi">42</span> <span class="p">(</span><span class="nf">evaluate</span><span class="p">)))))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>What I really want here is one macro not 5! I&rsquo;d like something I can easily extend as new forms of state come up.</p>

<h3>Composing Functions For A More Extensible Approach</h3>

<p>What if we could write test-motherload like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">test-motherload</span>
</span><span class='line'> <span class="p">(</span><span class="nf">with-runtime-state</span> <span class="p">{</span><span class="ss">:x</span> <span class="nv">X</span> <span class="ss">:y</span> <span class="nv">Y</span> <span class="ss">:z</span> <span class="nv">Z</span> <span class="ss">:a</span> <span class="nv">A</span> <span class="ss">:b</span> <span class="nv">B</span><span class="p">}</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="mi">42</span> <span class="p">(</span><span class="nf">evaluate</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And ideally if a C type of state comes up down the line, it&rsquo;ll be straightforward to extend this macro to accomodate it without pulling your hair out dealing with #&rsquo;s, ~&rsquo;s, @&rsquo;s, &lsquo;&rsquo;s and `&rsquo;s.</p>

<p>With a minor change to with-rules<em> and with-models</em> we can enable them to be used to compose 0-arity functions into other 0-arity functions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">rules-setup-and-teardown</span> <span class="p">[</span><span class="nv">rules</span> <span class="nv">body-fn</span><span class="p">]</span>
</span><span class='line'> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">old-rules</span> <span class="err">@</span><span class="nv">rules</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">reset!</span> <span class="nv">rules</span> <span class="p">(</span><span class="nf">evaluate-rules</span> <span class="nv">rules</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">body-fn</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">reset!</span> <span class="nv">rules</span> <span class="nv">old-rules</span><span class="p">))))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">models-setup-and-teardown</span> <span class="p">[</span><span class="nv">models</span> <span class="nv">body-fn</span><span class="p">]</span>
</span><span class='line'> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">old-models</span> <span class="err">@</span><span class="nv">models</span><span class="p">]</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">reset!</span> <span class="nv">models</span> <span class="nv">models</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">body-fn</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">reset!</span> <span class="nv">models</span> <span class="nv">old-models</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can take the testcase evaluation function and transform it into a function that when called will wrap the evaluate-test-case function in setup and teardown of the rules state.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">rules-setup-and-teardown</span>
</span><span class='line'>  <span class="o">&#39;</span><span class="p">(</span><span class="nf">def-rule</span> <span class="nv">priority-level</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="p">(</span><span class="nf">evalute-test-case</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we can chain these function compositions together, to incorporate more varieties of setup and teardown as necessary. Note we don&rsquo;t need no fancy macros for this (yet).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">test-model-and-level</span>
</span><span class='line'> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">testcase-fn</span> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="nv">true</span> <span class="p">(</span><span class="nf">found-promotion?</span>
</span><span class='line'>                                   <span class="p">(</span><span class="nf">legal-customer-session</span><span class="p">)))))</span>
</span><span class='line'>       <span class="nv">wrapped-testcase-fn</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">testcase-fn</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">rules-setup-and-teardown</span> <span class="o">&#39;</span><span class="p">(</span><span class="nf">def-rule</span> <span class="nv">priority-level</span> <span class="mi">5</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">models-setup-and-teardown</span> <span class="p">{</span><span class="ss">:a</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">]</span>
</span><span class='line'>                                          <span class="ss">:b</span> <span class="p">[</span><span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span><span class="p">]}))]</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">wrapped-testcase-fn</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remember what we&rsquo;re aiming for is something more like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">test-motherload</span>
</span><span class='line'> <span class="p">(</span><span class="nf">with-runtime-state</span> <span class="p">{</span><span class="ss">:x</span> <span class="nv">X</span> <span class="ss">:y</span> <span class="nv">Y</span> <span class="ss">:z</span> <span class="nv">Z</span> <span class="ss">:a</span> <span class="nv">A</span> <span class="ss">:b</span> <span class="nv">B</span><span class="p">}</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="mi">42</span> <span class="p">(</span><span class="nf">evaluate</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is going to require us to convert the state map, {:x X :y Y :z Z :a A :b B}, into the appropriate setup-and-teardown wrapper functions, and do the wrapping of the body of the macro as well.</p>

<p>The first definition option->setup-and-teardown-fn, maps keys from the state map to its corresponding setup-and-teardown function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="o">^</span><span class="ss">:private</span> <span class="nv">option-&gt;setup-and-teardown-fn</span>
</span><span class='line'> <span class="s">&quot;Add new setup and teardown wrappers here, and the `with-runtime-state`</span>
</span><span class='line'><span class="s">  macro automatically gets a new functionality&quot;</span>
</span><span class='line'> <span class="p">{</span><span class="ss">:rules</span> <span class="o">#</span><span class="ss">&#39;rules-setup-and-teardown</span>
</span><span class='line'>  <span class="ss">:models</span> <span class="o">#</span><span class="ss">&#39;models-setup-and-teardown</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally the macro that makes it all fit together. If you look closely, it macro
expands into something very similar to the composed function solution above.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-runtime-state</span> <span class="p">[</span><span class="nv">options</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">setup-and-teardowns</span>
</span><span class='line'>    <span class="c1">;; 1. map each key of the state-map to its a setup-and-teardown fn</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">state-value</span><span class="p">]</span> <span class="nv">options</span><span class="p">]</span>
</span><span class='line'>     <span class="o">`</span><span class="p">((</span><span class="k">fn </span><span class="p">[</span><span class="nv">f#</span><span class="p">]</span>
</span><span class='line'>       <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">setup-and-teardown#</span> <span class="p">(</span><span class="nb">get </span><span class="o">~</span><span class="nv">option-&gt;setup-and-teardown-fn</span> <span class="o">~</span><span class="nv">k</span><span class="p">)]</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">setup-and-teardown#</span> <span class="o">~</span><span class="nv">state-value</span> <span class="nv">f#</span><span class="p">)))))]</span>
</span><span class='line'>  <span class="c1">;; 2. thread the testcase body fn through each wrapper fn, and eval it</span>
</span><span class='line'>  <span class="o">`</span><span class="p">((</span><span class="nb">-&gt; </span><span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="o">~@</span><span class="nv">body</span><span class="p">)</span>
</span><span class='line'>     <span class="o">~@</span><span class="nv">setup-and-teardowns</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can make the macro more user friendly with a couple of asserts on the args passed to it. These kinds of assertions are especially nice in macros, because they help make the macro&rsquo;s unique syntax easier to use for your teammates without them pulling their hair out.</p>

<p>Also, we can be improve it one step further. We&rsquo;ll use clojure.core/partial to create the 1-arity setup-and-teardown functions, rather than wrapping each of them within the for expression.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="o">^</span><span class="ss">:private</span> <span class="nv">runtime-test-option-set</span> <span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">keys </span><span class="nv">option-&gt;setup-and-teardown-fn</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-runtime-state</span> <span class="p">[</span><span class="nv">options</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'> <span class="p">(</span><span class="nb">assert </span><span class="p">(</span><span class="nb">map? </span><span class="nv">options</span><span class="p">)</span>
</span><span class='line'>     <span class="s">&quot;Options should be a map.&quot;</span><span class="p">)</span>
</span><span class='line'> <span class="p">(</span><span class="nb">assert </span><span class="p">(</span><span class="nb">every? </span><span class="nv">runtime-test-option-set</span> <span class="p">(</span><span class="nb">keys </span><span class="nv">options</span><span class="p">))</span>
</span><span class='line'>     <span class="s">&quot;Options should have :rules and/or :feature-bits keys&quot;</span><span class="p">)</span>
</span><span class='line'> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">setup-and-teardowns</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">state-value</span><span class="p">]</span> <span class="nv">options</span><span class="p">]</span>
</span><span class='line'>     <span class="o">`</span><span class="p">((</span><span class="nb">partial </span><span class="p">(</span><span class="nb">get </span><span class="o">~</span><span class="nv">option-&gt;setup-and-teardown-fn</span> <span class="o">~</span><span class="nv">k</span><span class="p">)</span> <span class="o">~</span><span class="nv">state-value</span><span class="p">)))]</span>
</span><span class='line'>  <span class="o">`</span><span class="p">((</span><span class="nb">-&gt; </span><span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="o">~@</span><span class="nv">body</span><span class="p">)</span>
</span><span class='line'>     <span class="o">~@</span><span class="nv">setup-and-teardowns</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Refactoring Addendum</h3>

<p>I thought a little more about this and realized that even this macro is doing
too much.  We can actually extract the code that wraps a 0-arity function f in
setup-and-teardown functions. In the process we end up with a macro with one
line of code that does the heavy lifting and a few more lines of asserts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">wrap-in-setups-and-tear-downs</span> <span class="p">[</span><span class="nv">options</span> <span class="nv">f</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">setup-and-teardown-fns</span> <span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">state-value</span><span class="p">]</span> <span class="nv">options</span><span class="p">]</span>
</span><span class='line'>                                 <span class="p">(</span><span class="nb">partial </span><span class="p">(</span><span class="nb">get </span><span class="nv">option-&gt;setup-and-teardown-fn</span> <span class="nv">k</span><span class="p">)</span>
</span><span class='line'>                                          <span class="nv">state-value</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">reduce </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">f</span><span class="o">&#39;</span> <span class="nv">setup-and-teardown-fn</span><span class="p">]</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">setup-and-teardown-fn</span> <span class="nv">f</span><span class="o">&#39;</span><span class="p">))</span>
</span><span class='line'>            <span class="nv">f</span>
</span><span class='line'>            <span class="nv">setup-and-teardown-fns</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">with-runtime-state</span> <span class="p">[</span><span class="nv">options</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">assert </span><span class="p">(</span><span class="nb">map? </span><span class="nv">options</span><span class="p">)</span>
</span><span class='line'>          <span class="s">&quot;Options should be a map.&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">assert </span><span class="p">(</span><span class="nb">every? </span><span class="nv">runtime-test-option-set</span> <span class="p">(</span><span class="nb">keys </span><span class="nv">options</span><span class="p">))</span>
</span><span class='line'>          <span class="s">&quot;Options should have :rules and/or :feature-bits keys&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="o">`</span><span class="p">((</span><span class="nf">wrap-in-setups-and-tear-downs</span> <span class="o">~</span><span class="nv">options</span> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="o">~@</span><span class="nv">body</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a useful step because now we have another higher order function with which to build useful state-management tooling, and we&rsquo;ve eliminated more of the potentially confusing macro code.</p>

<h3>Takeaways</h3>

<p>So why go to all this trouble?</p>

<ul>
<li>We&rsquo;ve written a macro that is extensible.</li>
<li>We&rsquo;ve minimized actual lines of macro code. Yay!</li>
<li>We get validation of the state-map keys for free, anytime we extend this with a new setup-and-teardown function.</li>
<li><p>Our tests have a clean, uniform, minimal DSL for expressing pre-requisite mutable state.
How did we do it?</p></li>
<li><p>We took an essentially functional compositional approach.</p></li>
<li>We wrapped it in a layer of syntactic sugar.
Hope you enjoyed this little code walk through.</li>
</ul>


<p>Comments or questions?</p>

<h2>Comments</h2>

<div class='comments'>
<div class='comment'>
<div class='author'>Petr</div>
<div class='content'>
One more reason that using dynamic scope sucks.

BTW Have you thought of replacing set of *-setup-and-teardown with set of
{:setup (fn [] &#8230;.) :teardown (fn [] &#8230;.)} 
and not repeating (try &#8230; (finally &#8230;)) every time?</div>
</div>
<div class='comment'>
<div class='author'>Alex Baranosky</div>
<div class='content'>
Thanks.  I have at least got it into a stable state that should no longer break in Chrome.</div>
</div>
<div class='comment'>
<div class='author'>regeya</div>
<div class='content'>
cannot find brush for: clj

That&#39;s the dialog that keeps popping up every time I visit a page on this blog.</div>
</div>
<div class='comment'>
<div class='author'>Alex Baranosky</div>
<div class='content'>
Hi Alex, 

Thanks for the comment.  I actually thought I had added the appropriate tags last evening when I wrote it, but must have not saved my change.</div>
</div>
<div class='comment'>
<div class='author'>Alex Ott</div>
<div class='content'>
Hi 

thank you for posting this!
can you also add the clojure label to it, so it will be propagated into Planet Clojure?</div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Slamhound 1.3.0 - Cleaning up all your namespaces]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2012/12/26/slamhound-130-cleaning-up-all-your/"/>
    <updated>2012-12-26T17:22:00-08:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2012/12/26/slamhound-130-cleaning-up-all-your</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on"><br /></div> <p>Cleaning up namespaces in Clojure is a chore.  So noone does it, and the namespaces get worse.</p> <p>Enter <a href="https://github.com/technomancy/slamhound">Slamhound</a>.  Slamhound&#8217;s a library by Phil Hagelberg (the <a href="http://leiningen.org/">Leiningen</a> guy) that attempts to reconstruct a namespace for a file.</p> <p>For a while now Slamhound has been pretty unusable, do to it not having a good heuristic for figuring out which namespace to use for a require/as clause. For me, it would fail on most real-world namespaces I tried it on.</p> <p>Over Christmas break I decided to get it working again, because I was pretty sick of fixing up legacy namespaces by hand.  It now works, and also, as an added bonus, converts all your uses to requires, as per the Clojure 1.4 good practice.</p> <p>The original Slamhound `reconstruct` function returned a string representing the new namespace, but it was still tedious to run it on 50+ namespaces and copy-n-paste the new namespaces in.</p>    <p>For this reason, I decided to automate the process.  Long story short, the slam.hound namespace in version 1.3.0 now also has a -main function that takes a file or directory and replaces the namespace and writes it back to the file, or to all the files in the directory.  Like magic.</p> <p>Also, if you&#8217;re on Leiningen 2 you can define a partial alias:</p> <script class="brush: clj; gutter: false;" type="syntaxhighlighter">&lt;![CDATA[   :aliases {"slamhound" ["run" "-m" "slam.hound"]} ]]&gt;</script>  <p>and then call it from within your project&#8217;s root directory:</p> <script class="brush: bash; gutter: false;" type="syntaxhighlighter">&lt;![CDATA[ $ lein slamhound . ]]&gt;</script> <p>Then take a look at the diff for your repo.  You&#8217;ll see a lot of files have been altered.</p> <p>Caveats: Slamhound is still not perfect. It can lose metadata, or comments in the namespace form, and sometimes it picks the wrong dependencies to use in a namespace.</p></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reducing Complexity]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2012/12/02/reducing-complexity/"/>
    <updated>2012-12-02T02:33:00-08:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2012/12/02/reducing-complexity</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on"> <p>I had written some complicated looking code at work recently (shhh, let&#8217;s keep that between us ok?). Something about it didn&#8217;t seem right to me, but I was busy at the time so I wrote a TODO to come back and find a way to make it simpler.</p> <p>Since the code is so confusing it is virtually impossible to read at a glance and understand its intent, I will explain what it does.  It takes in a map where the keys are numbers of days over a given SLA, and the values are the number of shipments that were over the SLA by that amount of days.  The map actually can and does have more keys on it than that, but for the purposes of this article we can ignore them.  The function takes that map and converts it to a version where the values are not counts of the individual SLA, but instead the current running percentage totals.</p> An example:  <script class="brush: clj; gutter: false;" type="syntaxhighlighter">&lt;![CDATA[   (cumulative-percentage-past-SLA-map {:past-SLA-1 2 :past-SLA-2 1 :past-SLA-3 3} 4 10)   ;; => {:past-SLA-1 0.60 :past-SLA-2 0.70 :past-SLA-3 100.0} ]]&gt;</script> <p>What makes this code end up so complicated is that it is complecting three things: generating the series of sums, dividing them, and creating a new map to return.</p> <br/><pre class="brush: clj; gutter: false;"><br />(def ^:private all-past-SLA-x-keys [:past-SLA-1 :past-SLA-2 :past-SLA-3])<br /><br />(defn- cumulative-percentage-past-SLA-map<br />  "Takes a count-based report and generates percentages that accumulate."<br />  [count-based-past-SLA-map met-SLA total-shipments]<br />  (-> (reduce (fn [[past-SLA-map total-past-SLA-so-far] days-past-key]<br />                (let [updated-past-SLA-map (update-in past-SLA-map<br />                                                      [days-past-key]<br />                                                      #(/ (+ total-past-SLA-so-far %) total-shipments))<br />                      updated-total-past-SLA (+ total-past-SLA-so-far (get past-SLA-map days-past-key))]<br />                  [updated-past-SLA-map updated-total-past-SLA]))<br />              [count-based-past-SLA-map met-SLA]<br />              all-past-SLA-x-keys)<br />      first))<br /></pre><br/> <h3>The solution is to break those 3 parts up.</h3> <p>First we generate the series of sums using <a href="http://clojuredocs.org/clojure_core/clojure.core/reductions">reductions</a>.</p> <p>Second, we divide each by the total to convert them to percentages.</p> <p>Thirdly, we create a new map with percents as the values instead of counts.</p> <br/><pre class="brush: clj; gutter: false;"><br />(defn- cumulative-percentage-past-SLA-map<br />  "Takes a count-based report and generates percentages that accumulate."<br />  [count-based-past-SLA-map num-met-SLA total-shipments]<br />  (let [counts (map #(get count-based-past-SLA-map %) all-past-SLA-x-keys)<br />        running-totals (rest (reductions + num-met-SLA counts))<br />        percents (map #(/ % total-shipments) running-totals)]<br />    (zipmap all-past-SLA-x-keys<br />            percents)))<br /></pre><br/> <p>Another thing you might notice in this code is that I purposely used the more verbose `#(get count-based-past-SLA-map %)` when I could have just used `count-based-past-SLA-map`, as it is already a function!  I prefer to err on the side of making my code as obvious as possible, so I try to avoid using data structures as functions except under a few special cases. But I guess that would be a different topic for a different blog.</p> </div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Alex Baranosky</div>
<div class='content'>
I would probably do it that way if I wrote it today, too, without the `get`.  But I don&#39;t think it is a huge deal either way.</div>
</div>
<div class='comment'>
<div class='author'>Timothy Baldridge</div>
<div class='content'>
+1 I&#39;d rather treat functions as maps, than introduce syntactic sugar with #() and %.</div>
</div>
<div class='comment'>
<div class='author'>Alex Baranosky</div>
<div class='content'>
IMO this is an area where Clojure idioms venture into &quot;fancy&quot; territory.  It is a little Perlish.  At the end of the day it is a stylistic concern  and that kind of stuff is something that depends on what your team is most comfortable with. YMMV.</div>
</div>
<div class='comment'>
<div class='author'>Unknown</div>
<div class='content'>
I don&#39;t agree with the last part&#8230; In clojure you just don&#39;t use get, it is more idiomatic the other way. Using get just make it more confusing IMHO</div>
</div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Many Faces of Midje Fakes]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2012/02/27/many-faces-of-midje-fakes/"/>
    <updated>2012-02-27T19:21:00-08:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2012/02/27/many-faces-of-midje-fakes</id>
    <content type="html"><![CDATA[<div class='post'>
The <a href="https://github.com/marick/Midje">Midje</a> Clojure testing library enables top-down development, and the primary tool it has for enabling it is the fake.<br /><br />In Midje, you don&#8217;t have mock objects like you do in object-oriented languages, instead you fake out functions. The simplest way you can fake out functions is by using the provided form within your fact.<br /><br /><h3>Fakes</h3><pre class="brush: clj; gutter: false;"><br />(unfinished doubler)<br /><br />(defn six-times [x]<br />  (* 3 (doubler x)))<br /><br />(fact<br />  (six-times ..n..) => 12<br />  (provided<br />    (doubler ..n..) => 4))<br /></pre> <br/>(Things that look like ..x.. are called Midje metaconstants.  For now just pretend they are constants, or skip to the end of this article for a link to the wiki.)<br /><br />In the above example we&#8217;ve managed to define six-times in terms of a function, doubler, that is not yet defined (it is unfinished).<br /><br />Presumably the next thing we&#8217;d do when designing a piece of software like this is to write the fact for doubler.<br /><pre class="brush: clj; gutter: false;"><br />(fact <br />  (doubler 2) => 4)<br /><br />(defn doubler [n] (* 2 n))<br /></pre><br/>Or perhaps write a more thorough test:<br /><pre class="brush: clj; gutter: false;"><br />(tabular<br />  (fact (doubler n) => result)<br /><br />  n    result<br />  -2   -4<br />  -1   -2<br />  0    0<br />  1    2<br />  2    4<br />  100  200  )<br /></pre><br/>(Tabular is a way to write one fact that runs against multiple input sets.)<br /><br /><h3>The Myriad Uses of Fakes</h3><br />Fakes have other uses besides simple stubbing.<br /><br />They can also be used to verify call counts. Imagine that you want to check that when some data is not valid there are no calls to send-email, but otherwise there will be 1 call sent to each recipient?<br /><br />We can write this kind of test using the :times n prerequisite option. (where n is some non-negative integer) <pre class="brush: clj; gutter: false;"><br />(fact "don't send emails when data is invalid"<br />  (email-job :alex :brian) => irrelevant<br />  (provided<br />    (valid-data?) => false<br />    (email anything) => nil :times 0 ))<br /><br />(fact "when data is valid send one email to each recipient"<br />  (email-job :alex :brian) => irrelevant<br />  (provided<br />    (valid-data?) => true<br />    (email :alex) => nil :times 1<br />    (email :brian) => nil :times 1 ))<br /><br />;; The implementation<br /><br />(unfinished valid-data? email)<br /><br />(defn email-job [& dudes]<br />  (when (valid-data?)<br />    (doseq [d dudes]<br />      (email d))))<br /></pre><br /><h3>Checkers</h3><br />Using checkers we can even expand on the idea of what can be checked by a provided.  In the above examples first we used the anything checker to check that the email function was never called with anything. Then we simply checked that the email function was called with :alex and :brian once each.  <br /><br />In this example we want to check that the query function is called with 10 things that look like query maps. To do that we first need to create our own checker that checks whether the parameter looks like a query. <br/><pre class="brush: clj; gutter: false;"><br />(defchecker a-query [actual]<br />  (and (:target-db actual) (:query-plan actual)))<br /></pre><br />Midje will say that any arg matches this checker if it has a non-false/non-nil :target-db and :query-plan.<br /><br />Let&#8217;s confirm query is called 10 times with params that look like queries.<br /><pre class="brush: clj; gutter: false;"><br />(fact "always sends 10 queries"<br />  (execute-queries) => irrelevant<br />  (provided<br />    (query a-query) => irrelevant :times 10))<br /><br />;; The implementation<br /><br />(unfinished query)<br /><br />(defn execute-queries []<br />  (dotimes [_ 10]<br />    (query {:target-db :foo       ;; this will pass because it looks like a-query<br />            :query-plan :bar})))  ;; but (query {:another "map"}) would not pass<br /><br /><br /></pre><h3>The Fake Chain Gang</h3><br />If you&#8217;ve ever violated The Law of Demeter in an object-oriented language and then tried to use mock objects with the offending class, you may have experienced a chain of mocks.<br /><br />A chain of mocks is when you mock a method on a mock object that itself returns another mock object, that has a method on it mocked to *finally* return the value you want.<br /><br />when(mockA.call()).thenReturn(mockB);<br />when(mockB.call()).thenReturn(mockC);<br />when(mockC.call()).thenReturn(42);<br /><br />In Midje the naive approach might be to write something like:<br /><pre class="brush: clj; gutter: false;"><br />(fact<br />  (foo) => 42<br />  (provided <br />    (baz) => ..a.. ;; remember, just pretend they're constants<br />    (bar ..a..) => ..b..<br />    (qux ..b..) => 42))<br /><br />;; The implementation<br /><br />(unfinished baz bar qux)<br /><br />(defn foo [] <br />  (qux (bar (baz))))<br /></pre><br/>Midje supplies a feature called Folded Prerequisites that enable a nice condensed syntax for this, though it is probably a code smell if you are doing this too often.<br /><pre class="brush: clj; gutter: false;"><br />(fact<br />  (foo) => 42<br />  (provided<br />    (qux (bar (baz))) => 42))<br /></pre><br /><h3>Fakes That Cover Multiple Facts</h3><br />There are other ways to make fakes in Midje as well, by using the background macro and the against-background macros. These give you the ability to write fakes that cover a group of fakes.  I think I&#8217;ll talk about them in another blog though time permitting.<br /><br /><h3>Wiki Links</h3><a href="https://github.com/marick/Midje/wiki/Metaconstants">Metaconstants</a><br /><a href="https://github.com/marick/Midje/wiki/Checkers-within-prerequisites">Using Checkers in Fakes</a><br /><a href="https://github.com/marick/Midje/wiki/Folded-prerequisites">Folded Prerequisites</a></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Hema Powar</div>
<div class='content'>
Hey, saw your write ups. It is quite interesting. Please share your profile at hema.powar@wipro.com if you are looking for job. We have projects for a reputed client in Cupertino CA. Think you might have guessed the client already :-) <br /><br />Reach out to me at 201-272-6303</div>
</div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TDD in Midje in a Nutshell]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2012/02/19/tdd-in-midje-in-nutshell/"/>
    <updated>2012-02-19T17:41:00-08:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2012/02/19/tdd-in-midje-in-nutshell</id>
    <content type="html"><![CDATA[<div class='post'>
<a href="https://github.com/marick/Midje">Midje</a> is a Clojure testing library supporting a top-down mock function style of development, but also equally well supports a bottom-up style.<br /><br />This is an introductory article, and depending on the response, there will be more articles about some of the intermediate and advanced features.<br /><br /><h3>Elegant Examples</h3><br />Midje starts with a simple premise: that tests should be elegant and readable.<br /><br />When was the last time you saw code samples like this in somebody&#8217;s blog, gist, or book?<br /><br />EXAMPLE:<br /><i>As you can see the foo function always returns&nbsp;:a-ham-sandwich</i><br /><br />(foo :bar :baz)<br />;=&gt; :a-ham-sandwich<br /><br />As developers, I think we write examples like this, because it reads well to us. We&#8217;re used to this sort of pseudo-code example style, and so we can all tell at a glance what&#8217;s happening.<br /><br />This is where Midje enters. The below is executable Clojure Midje code:<br /><script type="syntaxhighlighter" class="brush: clj; gutter: false;">&lt;![CDATA[ (fact "the foo function always returns :a-ham-sandwich"   (foo :bar :baz) => :a-ham-sandwich) ]]&gt;</script>You can take that code, and run it, now, and if you&#8217;ve defined foo, then you can run `lein midje` or use midje-mode in Emacs to confirm that foo does in fact always return :a-ham-sandwich. (Forget for now that this particular fact doesn&#8217;t very well cover every possible input. Using a generated test input style of testing could be very useful here, but that is for another blog.)<br /><br /><h3>Describing Code That Doesn&#8217;t Exist - Yet</h3><br />Let&#8217;s try describing some code that doesn&#8217;t yet exist with these kinds of examples.  I think if we jot down some example cases, it will help us think more clearly about what we&#8217;re trying to get our code doing.<br /><script type="syntaxhighlighter" class="brush: clj; gutter: false;">&lt;![CDATA[ (fact "doubles odd numbers"   (my-func 3) => 6)  (fact "triples even numbers"   (my-func 4) => 12) ]]&gt;</script>We can run these examples now. First thing you&#8217;ll notice is that we&#8217;re getting errors; that&#8217;s of course because we have not yet written any code. Let&#8217;s add the my-func function.<br /><pre class="brush: clj; gutter: false;">(defn my-func [n] )<br /></pre>Let&#8217;s be cautious and just try to get one of these facts working first.<br /><pre class="brush: clj; gutter: false;">(defn my-func [n]<br />  (* 2 n))<br /></pre>This seems to work&#8230; but for only the first fact. (There&#8217;s a lot to be said for how effectively TDD can help you to stay focused on the task at hand.)<br /><br />So let&#8217;s get my-func to pass the second fact as well.<br /><pre class="brush: clj; gutter: false;">(defn my-func [n]<br />  (if (odd? n)<br />    (* 2 n)<br />    (* 3 n))<br /></pre>Running those examples again with lein midje or midje mode, we see that they do indeed pass.<br /><br />But there&#8217;s one more thing. There is a little bit of duplication left in my-func. Let&#8217;s take a second, and refactor this a little.<br /><pre class="brush: clj; gutter: false;">(defn my-func [n]<br />  (let [multiplier (if (odd? n) 2 3)]<br />    (* multiplier n))<br /></pre>Now that we&#8217;ve revealed a new concept of a multiplier in our code, it looks like we are done.  Our code works as advertised.<br /><br /><h3>TDD Recap</h3><br />You just learned:<br /><ul><li>how to use Midje facts as a form of executable examples</li><li>how to do TDD</li></ul>Nice.<br /><br />I was sneaky just then. Without letting you know what I was doing, I&#8217;ve walked you through the 4 steps of TDD. Decide what you are testing, write a failing test, make that test pass, refactor the code to have a good design.<br /><br /><h4>TDD Steps:</h4><ol><li>We chose a new piece of functionality we wanted the code to have.</li><li>We wrote a failing test.  We ran it.  We saw it fail. In Midje, we like to think of this step as taking some time to describe the facts of the future version of the code.</li><li>We wrote as little code as possible to make the test pass. In Midje, we think of this step as bringing the code up to date with the new facts.</li><li>We took some time to reorganize the code - giving it better structure, removing duplication, adjusting the naming, etc.</li></ol>Repeat.<br /><br />That&#8217;s TDD in Midje in a nutshell.<br /><br />What did you think? Interested in hearing some more intermediate or advanced TDD and Midje concepts and exercises?<br /><br /><h3>Technicalities</h3><script type="syntaxhighlighter" class="brush: clj; gutter: false;">&lt;![CDATA[  ;; project.clj setup  (defproject my-project "0.1.0"   ;; ...   :dev-dependencies [[lein-midje "1.0.8"]                      [midje "1.4.0-SNAPSHOT"]])   ;; example with ns macro  (ns my-ns.t-core   (:use my-ns.core         midje.sweet))  (fact   (foo :bar :baz) => :a-ham-sandwich) ]]&gt;</script></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>id</div>
<div class='content'>
Look closely at this screenshot (note: with noscript allowing all scripts except for the notorious google tracking bs) : http://bit.ly/IyQf46<br /><br />&quot;As developers, I think we write examples like this (&#8230;)&quot;<br /><br />As developers, *we* know that to mark up *code* you don&#39;t use a *script* tag.<br />a) as a noscript user, your reader won&#39;t know which of the dozen bs js sources to (temporarily) allow<br />b) even if you allow js, it won&#39;t work. &quot;Can&#39;t find brush for: clj&quot;<br />c) you can&#39;t just read it. No JS: no content? Fail!<br /><br />For a bit of potential syntax highlighting, you break your article. I applaud you, dear developer.</div>
</div>
<div class='comment'>
<div class='author'>nodename.com</div>
<div class='content'>
Yes, keep it going!</div>
</div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[B.A.Z.N.E.X. - Boston Autonomous Zone Nerd Nexus]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2011/10/25/baznex-boston-autonomous-zone-nerd/"/>
    <updated>2011-10-25T16:08:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2011/10/25/baznex-boston-autonomous-zone-nerd</id>
    <content type="html"><![CDATA[<div class='post'>
<div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span id="internal-source-marker_0.16010997292046103" style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span></div><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;">B.A.Z.N.E.X.: Boston Autonomous Zone Nerd Nexus</h3><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">The  short version is that were a self-directed organization  focused on the joys of software development, community, and learning.</span><br /><br /><a href="http://baznex.herokuapp.com/" target="_blank"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX</span></a></div><br><br /><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><h3>Before we get into more details about what we are lets start with what it is NOT</h3></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span></div><ul style="color: black; font-family: Arial,Helvetica,sans-serif;"><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is not a meetup, but we do meet together. </span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is not a forum, but we do discuss.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is not a lesson, because there is no one teacher.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX  is not corporate sponsored, because we dont have ulterior motives of  hiring you. &nbsp;Were here to better ourselves and, ultimately, the world.  &nbsp;But who knows who you might meet, and what connections might be born.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is not an open source programming club, but we might work on some open source projects.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX  is not a place to teach or be taught, but it is a place to grow  together with others, and to teach when called upon to do so.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX  has NO agenda. There are no lectures and no prearranged topics. You  come, you meet others, and you join the party. That good vibe you feel  here is what we call the </span><span style="background-color: transparent; font-size: 11pt; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Nerd Nexus</span><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX has no leader, but for the force of willpower generated through a phenomenon called a </span><span style="background-color: transparent; font-size: 11pt; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Nerd Nexus</span><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">  - that moment with the vibes so delicious, and the love of computer  science and software development, as well as the inspired action for the  community, and for the history of computing. </span></li></ul><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span></div><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;">&nbsp;</h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;">Okay, BAZNEX isnt any of those things. So what IS it??</h3><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span></div><ul style="color: black; font-family: Arial,Helvetica,sans-serif;"><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is appreciating and revering the history of our profession.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is sharing cool software stuff.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is experiencing the greater nerd community of Boston.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX  is pairing together with others to share expertise, and to contribute  back to the Open Source community, and the community at large.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is about the community of software developers.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is about appreciating the venerable greats of our industry and mooching off of their awesomeness by osmosis.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX is about bringing up novices.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Yes. BAZNEX is a software osmosis, free-form, group software </span><span style="background-color: transparent; font-size: 11pt; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">block-party</span><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">On any given BAZNEX meeting (we call them nexuses) pretty much anything could happen.</span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">But  you can generally count on working on some code, and learning cool  stuff from those you pair up with at the nexus. &nbsp;You are encouraged to  write on the wiki what your interests are; that way others who are  interested in learning with you can say hello and you may pair together,  and vice versa!&nbsp; </span></li><li><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">BAZNEX grows organically; your presence makes you a part of it all, and so your desires matter.&nbsp; </span></li></ul><br /><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;">What you can do if you&#8217;re interested in joining the Nexus</h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"> We&#8217;re very much in a primordial state. We have had one small (successful!) gathering of three at the Andala coffee shop in Central Square Cambridge where we discussed why I love index cards, a bit about teaching others programming, took a look at the <a href="https://github.com/daveray/seesaw">SeeSaw</a> Clojure Swing-wrapping library, and took time to work on adding a feature to <a href="https://github.com/marick/Midje">Midje</a>, a Clojure testing/mocking framework.</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">&nbsp;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">The current process we&#8217;ve done (a total of one time) is to have everyone write down on index cards&nbsp; the different activities they might want to do at that gathering.&nbsp; Then put them all together and we split up into pairs or triples. Last gathering index cards were written such as &#8221; want to look at SeeSaw?&#8221;, &#8220;talk more about teaching programming&#8221;, &#8220;fix the code Alex broke in Midje&#8221;, &#8220;do some remote pairing, or at least learn more about how we could&#8221;, &#8220;create a Content Management system in Clojure&#8221;, &#8220;can anyone help me with my 5 minute lightning talk on Clojure I&#8217;m doing tomorrow?&#8221;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">&nbsp;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">We&#8217;re looking into finding larger venues preferably closer to downtown Boston for easier access by all of us, and places that can fit more of us than just a coffee shop can handle.&nbsp; Sprout in Davis Square is going to be our next location to try out on Wednesday Nov 1. &nbsp;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">&nbsp;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"> Also, if this all is jiving with you, we&#8217;ve got a <a href="http://groups.google.com/group/baznex">BAZNEX Google Group</a> we&#8217;ve just started, where all future discussion of BAZNEX will transpire.&nbsp;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">&nbsp;</span></h3><h3 style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="background-color: transparent; font-size: 11pt; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Please tell anyone you think may be interested. The more the merrier.&nbsp; Any suggestions, offerings, additions, or displays of exuberance, also invited.</span></h3></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Few Nice Features Of Clojure, Part #1: Using Macros To Freeze Time]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2011/10/23/few-nice-features-of-clojure-part-1/"/>
    <updated>2011-10-23T18:25:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2011/10/23/few-nice-features-of-clojure-part-1</id>
    <content type="html"><![CDATA[<div class='post'>
<div style="color: black; font-family: Arial,Helvetica,sans-serif;"></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">I thought it might be fun to show some of Clojure&#8217;s features off by taking a look at how I use some of them in my own project <a href="https://github.com/AlexBaranosky/EmailClojMatic">EmailClojMatic</a>.&nbsp; I&#8217;ve got 4 features in mind and will show one feature each post.<br /><br /><b>Problem #1:</b><br /><br />We want to unit test a function that depends on the current date.<br /><br /><b>Solution #1:</b><br /><br />Fortunately we are using <a href="http://joda-time.sourceforge.net/">JodaTime</a>, a great Java date/time library.&nbsp; JodaTime has built in features for setting the &#8216;now&#8217; time.&nbsp; Let&#8217;s use those to create a function to wrap our test code in, that will set the time at a given DateTime.<br /><br /><pre class="brush: clj; gutter: false;">(defn do-at* [date-time f]<br />  (DateTimeUtils/setCurrentMillisFixed (.getMillis date-time))<br />  (try<br />    (f)<br />    (finally (DateTimeUtils/setCurrentMillisSystem))))<br /><br />;; you might use this code like this:<br /><br />(do-at* (DateMidnight. 2000 1 1)<br />  (fn [] (DateMidnight.))) ;;=> (DateMidnight. 2000 1 1)<br /></pre><br />If you are like me and you find yourself writing test code using this construct frequently you can use Clojure&#8217;s macro functionality to essentially extend the Clojure language to have a new feature for evaluating an expression at a given DateTime.&nbsp; This way we won&#8217;t have to always wrap the expression in a function like we are doing in the do-at* function.<br /><br />Let&#8217;s see the macro version that I decided to call `do-at`, because it is just like the built in Clojure function `do` except it evaluates at the given time. [It&#8217;s probably worth noting that xyz* function with xyz companion macro is a common Clojure idiom. -@darevay]</div><br /><pre class="brush: clj; gutter: false;">(defmacro do-at [date-time & body]<br />  "like clojure.core.do except evalautes the<br />  expression at the given time"<br />  `(do-at* ~date-time<br />    (fn [] ~@body)))<br /><br />;; nice. Now we can see the actual code that was hiding<br />;; behind all of those parens and fn creation:<br /><br />(do-at (DateMidnight. 2000 1 1)<br />  (DateMidnight.)) ;;=> (DateMidnight. 2000 1 1)<br /></pre><br /><div style="color: black; font-family: Arial,Helvetica,sans-serif;">It&#8217;s pretty powerful the way that macros give you the ability to shape your library so that it is free of boiler plate.</div></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Simplicity is a Prerequisuite for Reliability]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2011/10/13/simplicity-is-prerequisuite-for/"/>
    <updated>2011-10-13T09:04:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2011/10/13/simplicity-is-prerequisuite-for</id>
    <content type="html"><![CDATA[<div class='post'>
<div style="color: black; font-family: Arial,Helvetica,sans-serif;"><i><span style="font-size: small;">(This blog post is based on <a href="http://www.codequarterly.com/2011/rich-hickey/">Rich Hickey&#8217;s</a> keynote speech at Strange Loop 2011)</span></i></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><b><span style="font-size: large;">Word origins</span></b></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Could we go back to what these words REALLY mean?</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Simple: sim-plex - one fold/braid</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Complex: many folds/braids</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Easy: &#8230; lie near</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Simple</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">One fold/braid</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">One role</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">One task!</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">One concept</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">One dimension</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">But not</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">&nbsp;&nbsp;&nbsp; one instance</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">&nbsp;&nbsp;&nbsp; one operation</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">&nbsp;&nbsp;&nbsp; it&#8217;s about lack of interleaving, it&#8217;s not cardinality</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><i>Interleavage is an Objective notion</i></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Easy</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Near, physically</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">&nbsp;&nbsp;&nbsp; on our own hard drive, in our toolset, IDE, apt get, gem install.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Near, to our current understand/skill set</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">&nbsp;&nbsp;&nbsp; familiar - mentally near.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">We&#8217;re generally overly fixated on these two meanings of easy.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">If you want everything to be familiar, you learn NOTHING.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">There&#8217;s a third meaning of easy:</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Near, to our capabilities.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><i>Easy is RELATIVE - unlike simple</i></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Limits</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">We can only hope to make reliable those things we understand.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">We can only consider a few things at a time.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Intertwined things must be considered together. This is a mental burden and the intertwining tends to grow combinatorially.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Complexity undermines understanding.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Simplicity Driven Development</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: small;"><br /></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><span style="font-size: small;">If you ignore complexity - you will invariably sloooowwww down over time.<br /><br />If you focus on ease - you will have a fast at start, and slow down every iteration to redo everything.<br /><br />If you focus on simplicity - you will go a bit slower at the start, but then ramp up to a higher steady state of productivity.</span><b> </b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>What is In Your Toolkit?</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><b>Complex</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Simple</b></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">state, objects&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; values</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">methods&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; functions, namespaces</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">vars&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; managed refs</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">inheritence, switch, matching&nbsp; polymorphism</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">syntax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">imperative loops, fold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set functions</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">actors&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; queues</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">ORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; declarative data manipulation</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">conditionals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rules</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">inconsistency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; consistency</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b><br /></b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Complect</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">archaic word meaning &#8220;to braid together&#8221;</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">don&#8217;t do it</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">complecting things is a source complexity</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">best to avoid in the first place</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><br /></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Compose</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">meaning &#8220;to place together&#8221;</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">composing simple components is the way we write robust software!</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">We can make simple systems by making them modular.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">What do we want to make these two parts of code allowed to think about??</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">In other words, program towards abstractions!</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Don&#8217;t be fooled by code organization. Two things can be physically separate, but to change one means you need to change the other - they are complected</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>State is Never Simple</b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">It complects value and time</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">But it is so EASY!</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">It interleaves everything that touches it, directly or indirectly.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>Programming Features That Complect</b></span> </div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><b>Feature&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Complects</b></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; everything they touch</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Objects&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; state, identity, value</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Methods&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function and state, namespaces</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Syntax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; meaning, order</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Inheritance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; types</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">switching/matching&nbsp;&nbsp; multiple who what pairs</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">variables&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; value, time</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">loop, fold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; what/how</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">actors&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; what to do, who does it</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">ORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OMG</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><i>Simplicity is NOT the same as Easy - Remember that - It is KEY</i></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b><br /></b></span></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><span style="font-size: large;"><b>The Simplicity Recipe</b></span><br /><br />You do not need C#/Java/C++.&nbsp; You can make big systems with dramatically simpler tools.<br /><br />We make hundreds of variations that make it tough to manipulate the essence of this stuff - data.&nbsp; We should use simple data so we can write code to work on the essence of this stuff.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Develop sensibilities around entanglement - learn to see the complecting.<br /><br />Tools for reliability like testing, refactoring, etc are all safety nets that are orthogonal to this problem.<br /><br />Choose simple constructs over constructs that encourage braided together code.<br /><br />Simplify the problem space before you start.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Simplicity often mean you have more things&#8230; it&#8217;s not about counting.</div><div style="color: black; font-family: Arial,Helvetica,sans-serif;"><br /></div><div style="color: black; font-family: Arial,Helvetica,sans-serif;">Reap the benefits!</div></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Scala Writer Monad]]></title>
    <link href="http://AlexBaranosky.github.io/blog/2011/10/05/scala-writer-monad/"/>
    <updated>2011-10-05T20:00:00-07:00</updated>
    <id>http://AlexBaranosky.github.io/blog/2011/10/05/scala-writer-monad</id>
    <content type="html"><![CDATA[<div class='post'>
<div><br /><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">In  Scala were quite familiar with the built in Monads:&nbsp;</span></div><ul style="margin-left: 1.5em;"><li style="color: black;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Option</span></li><li style="color: black;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">List</span></li><li style="color: black;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Either Left Projection</span></li><li style="color: black;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Either Right Projection</span></li></ul><div></div><div><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">There are other  cool things you can do with the Monad pattern, though, one of which is termed the  Writer monad.</span><br /><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span></div><div><br /><span style="background-color: transparent; color: black; font-family: Arial; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">This  data type represents logging in a pure functional environment where you  maintain compositionality of your code (i.e. no side-effects) and also,  brevity of code. <span style="font-style: normal;">&nbsp;</span></span></div><div></div><span style="background-color: transparent; color: black; font-family: Arial; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"><span style="font-style: normal;">&#8211; <a href="http://blog.tmorris.net/the-writer-monad-using-scala-example/"> http://blog.tmorris.net/the-writer-monad-using-scala-example/</a></span></span><br /><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Writer Monad 0.1</span></span><br /><br /><script src="https://gist.github.com/1266102.js">  </script><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">There&#8217;s a Problem. Its not generic. Let&#8217;s make the value type generic.</span></span><br /><br /><script src="https://gist.github.com/1266120.js">  </script><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">But it only works with Strings&#8230;</span></span><br /><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Introducing the Typeclass pattern</span></span><br /><br /><script src="https://gist.github.com/1266126.js">  </script><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Our new version still works</span></span><br /><script src="https://gist.github.com/1266130.js">  </script><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Why didnt we just extend String with a trait?</span></span><br /><div dir="ltr"><div><div dir="ltr"><div><div dir="ltr"><div></div></div><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Notice  we could have implemented this using traits, and specified in the type  signature that type D of diary had to extend Monoid. &nbsp;</span></div><div></div><div><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">Had we done that,  we would have needed to own the String class (which we dont have access  to) so it could extend trait Monoid, or we would have had to extend it  manually at run-time.</span></div><div></div></div></div></div><br /><script src="https://gist.github.com/1266134.js">  </script><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Watch how using the typeclass pattern made it simple to use other classes as the diary for our Writer</span></span><br /><br /><script src="https://gist.github.com/1266137.js">  </script><br /><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">What we learned</span></span><br /><div dir="ltr"><div style="font-weight: bold;"><div dir="ltr"><div style="color: black; font-size: 1.3em;"></div><div style="color: black; font-size: 1.3em;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">We could get our Writer to work with a 3rd party class without needing to change either the Writer or the StringBuilder code.</span><br /><br /><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">This Writer pattern can be used with anything that starts from nothing (zero) and can be built up piece by piece (diary). In essence Writer Monad is a sort of immutable, functional Builder pattern. </span><br /><br /></div><div style="color: black; font-size: 1.3em;"></div><div style="color: black; font-size: 1.3em;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">We  saw that we&#8217;re not limited to the monads Scala comes packaged with.&nbsp; We  can use our own monads to define computational contexts to suit our  code&#8217;s unique needs.</span></div><div style="color: black; font-size: 1.3em;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"><br clear="none" /></span></div></div><span style="font-size: large;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Writer Monad Materials </span></span></div><div style="font-weight: bold;"></div><div style="font-weight: bold;"><span style="background-color: transparent; color: black; font-family: Arial; font-style: italic; font-variant: normal; text-decoration: none; vertical-align: baseline;">Learn You a Haskell for Great Good:<span style="font-weight: normal;"> </span></span><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span><br /><a href="http://learnyouahaskell.com/for-a-few-monads-more#writer" style="font-weight: normal;"><span style="background-color: transparent; color: #000099; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline;">http://learnyouahaskell.com/for-a-few-monads-more#writer</span></a><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span><br /><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;"></span><br /><span style="background-color: transparent; color: black; font-family: Arial; font-style: italic; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;">Scalaz Writer: </span><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline;"></span><br /><a href="http://scalaz.github.com/scalaz/scalaz-2.9.0-1-6.0/doc.sxr/scalaz/Writer.scala.html"><span style="background-color: transparent; color: black; font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline;">http://scalaz.github.com/scalaz/scalaz-2.9.0-1-6.0/doc.sxr/scalaz/Writer.scala.html</span></a></div></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Dombou</div>
<div class='content'>
None of this code works. There&#39;s also quite a few syntax errors.</div>
</div>
<div class='comment'>
<div class='author'>ExternalReality</div>
<div class='content'>
I learn something new everyday!</div>
</div>
</div>
]]></content>
  </entry>
  
</feed>
