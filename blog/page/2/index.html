
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>(elegant coding from a more civilized age)</title>
  <meta name="author" content="Alex Baranosky">

  
  <meta name="description" content="I thought it might be fun to show some of Clojure&rsquo;s features off by taking a look at how I use some of them in my own project EmailClojMatic. I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://AlexBaranosky.github.io/blog/page/2/index.html">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="(elegant coding from a more civilized age)" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1>(elegant coding from a more civilized age)</h1>
  
    <h2><a href="/">Lisp++</a></h2>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:AlexBaranosky.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/10/few-nice-features-of-clojure-part-1.html">A Few Nice Features of Clojure, Part #1: Using Macros to Freeze Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-23T18:25:00-07:00" pubdate data-updated="true">Oct 23<span>rd</span>, 2011</time>
        
         | <a href="/2011/10/few-nice-features-of-clojure-part-1.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I thought it might be fun to show some of Clojure&rsquo;s features off by taking a look at how I use some of them in my own project <a href="https://github.com/AlexBaranosky/EmailClojMatic">EmailClojMatic</a>. I&rsquo;ve got 4 features in mind and will show one feature each post.</p>

<p><strong>Problem #1:</strong></p>

<p>We want to unit test a function that depends on the current date.</p>

<p><strong>Solution #1:</strong></p>

<p>Fortunately we are using <a href="http://joda-time.sourceforge.net/">JodaTime</a>, a great Java date/time library. JodaTime has built in features for setting the &lsquo;now&rsquo; time. Let&rsquo;s use those to create a function to wrap our test code in, that will set the time at a given DateTime.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">do-at*</span> <span class="p">[</span><span class="nv">date-time</span> <span class="nv">f</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">DateTimeUtils/setCurrentMillisFixed</span> <span class="p">(</span><span class="nf">.getMillis</span> <span class="nv">date-time</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">f</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">finally</span> <span class="p">(</span><span class="nf">DateTimeUtils/setCurrentMillisSystem</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; you might use this code like this:</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">do-at*</span> <span class="p">(</span><span class="nf">DateMidnight.</span> <span class="mi">2000</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="p">(</span><span class="nf">DateMidnight.</span><span class="p">)))</span> <span class="c1">;;=&gt; (DateMidnight. 2000 1 1)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you are like me and you find yourself writing test code using this construct frequently you can use Clojure&rsquo;s macro functionality to essentially extend the Clojure language to have a new feature for evaluating an expression at a given DateTime. This way we won&rsquo;t have to always wrap the expression in a function like we are doing in the do-at* function.</p>

<p>Let&rsquo;s see the macro version that I decided to call <code>do-at</code>, because it is just like the built in Clojure function <code>do</code> except it evaluates at the given time. [It&rsquo;s probably worth noting that xyz* function with xyz companion macro is a common Clojure idiom. &ndash;@darevay]</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">do-at</span> <span class="p">[</span><span class="nv">date-time</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'>  <span class="s">&quot;like clojure.core.do except evalautes the</span>
</span><span class='line'><span class="s">  expression at the given time&quot;</span>
</span><span class='line'>  <span class="o">`</span><span class="p">(</span><span class="nf">do-at*</span> <span class="o">~</span><span class="nv">date-time</span>
</span><span class='line'>    <span class="p">(</span><span class="k">fn </span><span class="p">[]</span> <span class="o">~@</span><span class="nv">body</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; nice. Now we can see the actual code that was hiding</span>
</span><span class='line'><span class="c1">;; behind all of those parens and fn creation:</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">do-at</span> <span class="p">(</span><span class="nf">DateMidnight.</span> <span class="mi">2000</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">DateMidnight.</span><span class="p">))</span> <span class="c1">;;=&gt; (DateMidnight. 2000 1 1)</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s pretty powerful the way that macros give you the ability to shape your library so that it is free of boiler plate.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/10/simplicity-is-prerequisuite-for.html">Simplicity Is a Prerequisuite for Reliability</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-13T09:04:00-07:00" pubdate data-updated="true">Oct 13<span>th</span>, 2011</time>
        
         | <a href="/2011/10/simplicity-is-prerequisuite-for.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>(This blog post is based on <a href="http://www.codequarterly.com/2011/rich-hickey/">Rich Hickey&rsquo;s</a> keynote speech at Strange Loop 2011)</em></p>

<h2>Word origins</h2>

<ul>
<li>Could we go back to what these words REALLY mean?</li>
<li>Simple: sim-plex &ndash; one fold/braid</li>
<li>Complex: many folds/braids</li>
<li>Easy: &hellip; lie near</li>
</ul>


<h2>Simple</h2>

<ul>
<li>One fold/braidOne roleOne task!One conceptOne dimension</li>
<li>But not one instance one operation it&rsquo;s about lack of interleaving, it&rsquo;s not cardinality</li>
<li><em>Interleavage is an Objective notion</em></li>
</ul>


<h2>Easy</h2>

<ul>
<li>Near, physically on our own hard drive, in our toolset, IDE, apt get, gem install.</li>
<li>Near, to our current understand/skill set familiar &ndash; mentally near.</li>
<li>We&rsquo;re generally overly fixated on these two meanings of easy.</li>
<li>If you want everything to be familiar, you learn NOTHING.</li>
<li>There&rsquo;s a third meaning of easy:</li>
<li>Near, to our capabilities.</li>
<li><em>Easy is RELATIVE &ndash; unlike simple</em></li>
</ul>


<h2>Limits</h2>

<ul>
<li>We can only hope to make reliable those things we understand.</li>
<li>We can only consider a few things at a time.</li>
<li>Intertwined things must be considered together. This is a mental burden and the intertwining tends to grow combinatorially.</li>
<li>Complexity undermines understanding.</li>
</ul>


<h2>Simplicity Driven Development</h2>

<ul>
<li>If you ignore complexity &ndash; you will invariably sloooowwww down over time.</li>
<li>If you focus on ease &ndash; you will have a fast at start, and slow down every iteration to redo everything.</li>
<li>If you focus on simplicity &ndash; you will go a bit slower at the start, but then ramp up to a higher steady state of productivity.<strong> </strong></li>
</ul>


<h2>What is In Your Toolkit?</h2>

<ul>
<li>Complex</li>
<li>Simple</li>
<li>state, objects, values, methods, functions, namespaces, vars, managed refs,
inheritence, switch, matching polymorphism, syntax data, imperative loops, fold
set functions, actors queues, ORM declarative data manipulation, conditionals,
rules, inconsistency consistency</li>
</ul>


<h2>Complect</h2>

<p>archaic word meaning &ldquo;to braid together&rdquo;
don&rsquo;t do it
complecting things is a source complexity
best to avoid in the first place</p>

<h2>Compose</h2>

<ul>
<li>meaning &ldquo;to place together&rdquo;</li>
<li>composing simple components is the way we write robust software!</li>
<li>We can make simple systems by making them modular.</li>
<li>What do we want to make these two parts of code allowed to think about??</li>
<li>In other words, program towards abstractions!</li>
<li>Don&rsquo;t be fooled by code organization. Two things can be physically separate, but to change one means you need to change the other &ndash; they are complected</li>
</ul>


<h2>State is Never Simple</h2>

<ul>
<li>It complects value and time</li>
<li>But it is so EASY!</li>
<li>It interleaves everything that touches it, directly or indirectly.</li>
</ul>


<h2>Programming Features That Complect</h2>

<p><strong>Feature Complects</strong></p>

<p>State everything they touch</p>

<p>Objects state, identity, value</p>

<p>Methods function and state, namespaces</p>

<p>Syntax meaning, order</p>

<p>Inheritance  types
switching/matching multiple who what pairsvariables  value, timeloop, fold     what/howactors    what to do, who does itORM OMG
<em>Simplicity is NOT the same as Easy &ndash; Remember that &ndash; It is KEY</em><strong>
</strong><strong>The Simplicity Recipe</strong></p>

<p>You do not need C#/Java/C++. You can make big systems with dramatically simpler tools.</p>

<p>We make hundreds of variations that make it tough to manipulate the essence of this stuff &ndash; data. We should use simple data so we can write code to work on the essence of this stuff.
Develop sensibilities around entanglement &ndash; learn to see the complecting.</p>

<p>Tools for reliability like testing, refactoring, etc are all safety nets that are orthogonal to this problem.</p>

<p>Choose simple constructs over constructs that encourage braided together code.</p>

<p>Simplify the problem space before you start.
Simplicity often mean you have more things&hellip; it&rsquo;s not about counting.
Reap the benefits!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/10/scala-writer-monad.html">A Scala Writer Monad</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-05T20:00:00-07:00" pubdate data-updated="true">Oct 5<span>th</span>, 2011</time>
        
         | <a href="/2011/10/scala-writer-monad.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In  Scala we’re quite familiar with the built in Monads:</p>

<ul>
<li>Option</li>
<li>List</li>
<li>Either Left Projection</li>
<li>Either Right Projection</li>
</ul>


<p>There are other cool things you can do with the Monad pattern, though, one of
which is termed the  Writer monad.</p>

<p>“This  data type represents logging in a pure functional environment where you  maintain compositionality of your code (i.e. no side-effects) and also,  brevity of code.” &ndash; <a href="http://blog.tmorris.net/the-writer-monad-using-scala-example/"> http://blog.tmorris.net/the-writer-monad-using-scala-example/</a></p>

<h2>Writer Monad 0.1</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">diary</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">flatMap</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Writer</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">diary</span> <span class="o">+</span> <span class="n">d</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">map</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">),</span> <span class="n">diary</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// This enables us to say:</span>
</span><span class='line'><span class="k">new</span> <span class="nc">Writer</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span> <span class="k">new</span> <span class="nc">Writer</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">&quot;three&quot;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>                 <span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="k">new</span> <span class="nc">Writer</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">&quot;four&quot;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="c1">// =&gt; Writer(4, &quot;threefour&quot;)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>There&rsquo;s a Problem. It’s not generic. Let&rsquo;s make the value type generic.</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">diary</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>           <span class="k">case</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">diary</span> <span class="o">+</span> <span class="n">d</span><span class="o">)</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="err">]</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">),</span> <span class="n">diary</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>But it only works with Strings: Introducing the Typeclass pattern</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">D</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">diary</span><span class="k">:</span> <span class="kt">D</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">D</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Writer2</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">D</span><span class="o">])</span> <span class="k">=</span>  <span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">diary</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">D</span><span class="o">](</span><span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">),</span> <span class="n">diary</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">trait</span> <span class="nc">Monoid</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">def</span> <span class="n">zero</span><span class="k">:</span> <span class="kt">T</span>
</span><span class='line'>   <span class="k">def</span> <span class="n">append</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">object</span> <span class="nc">Monoid</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">implicit</span> <span class="k">val</span> <span class="nc">StringMonoid</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monoid</span><span class="o">[</span><span class="kt">St</span> <span class="kt">ring</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">override</span> <span class="k">def</span> <span class="n">zero</span> <span class="k">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>       <span class="k">override</span> <span class="k">def</span> <span class="n">append</span><span class="o">(</span><span class="n">s1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">s2</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Our new version still works</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">Writer</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">num</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">num</span> <span class="o">+</span> <span class="mi">3</span><span class="o">,</span> <span class="s">&quot;added three&quot;</span><span class="o">)</span>
</span><span class='line'>             <span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="nc">Writer</span><span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="mi">5</span><span class="o">,</span> <span class="s">&quot;times five&quot;</span><span class="o">)}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// =&gt; Writer(40, &quot;added threetimes 5&quot;) </span>
</span></code></pre></td></tr></table></div></figure>


<h2>Why didn’t we just extend String with a trait?</h2>

<p>Notice  we could have implemented this using traits, and specified in the type  signature that type D of diary had to extend Monoid. Had we done that,  we would have needed to own the String class (which we don’t have access  to) so it could extend trait Monoid, or we would have had to extend it  manually at run-time.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">Monoid</span> <span class="o">{</span>
</span><span class='line'> <span class="k">implicit</span> <span class="k">val</span> <span class="nc">StringMonoid</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monoid</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>     <span class="k">override</span> <span class="k">def</span> <span class="n">zero</span> <span class="k">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>     <span class="k">override</span> <span class="k">def</span> <span class="n">append</span><span class="o">(</span><span class="n">s1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">s2</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>             <span class="k">val</span>  <span class="n">delimiter</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">s1</span> <span class="o">==</span> <span class="n">zero</span> <span class="o">||</span> <span class="n">s2</span> <span class="o">==</span> <span class="n">zero</span><span class="o">)</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>                              <span class="k">else</span> <span class="s">&quot;, &quot;</span>
</span><span class='line'>             <span class="n">s1</span> <span class="o">+</span> <span class="n">delimiter</span> <span class="o">+</span> <span class="n">s2</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'> <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">Writer</span><span class="o">(</span><span class="mi">5</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">3</span><span class="o">,</span> <span class="err">“</span><span class="n">added</span> <span class="n">three</span><span class="err">”</span><span class="o">)</span>
</span><span class='line'>           <span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">5</span><span class="o">,</span> <span class="s">&quot;times five&quot;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>           <span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Writer</span><span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="s">&quot;plusTwo&quot;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="c1">// =&gt; Writer(42, &quot;added three, times 5, plus two&quot;) </span>
</span></code></pre></td></tr></table></div></figure>


<h2>Watch how using the typeclass pattern made it simple to use other classes as the ‘diary’ for our Writer</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">Monoid</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">implicit</span> <span class="k">val</span> <span class="nc">StringBuilderMonoid</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monoid</span><span class="o">[</span><span class="kt">StringBuilder</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">override</span> <span class="k">def</span> <span class="n">zero</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="k">override</span> <span class="k">def</span> <span class="n">append</span><span class="o">(</span><span class="n">sb1</span><span class="k">:</span> <span class="kt">StringBuilder</span><span class="o">,</span> <span class="n">sb2</span><span class="k">:</span> <span class="kt">StringBuilder</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">val</span>  <span class="n">delimiter</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">sb1</span><span class="o">.</span><span class="n">toString</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="o">||</span>
</span><span class='line'>                                 <span class="n">sb2</span><span class="o">.</span><span class="n">toString</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="o">)</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>                             <span class="k">else</span> <span class="s">&quot;, &quot;</span>
</span><span class='line'>            <span class="n">sb1</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">delimiter</span><span class="o">).</span><span class="n">append</span><span class="o">(</span><span class="n">sb2</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">Writer</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)).</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">n</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="nc">Writer</span><span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">&quot;plus two&quot;</span><span class="o">))</span>
</span><span class='line'><span class="o">}.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">n</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="nc">Writer</span><span class="o">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">&quot;times four&quot;</span><span class="o">))</span>
</span><span class='line'><span class="o">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// =&gt; Writer(96, StringBuilder(&quot;plus two, times four&quot;)) </span>
</span></code></pre></td></tr></table></div></figure>


<h2>What we learned</h2>

<p>We could get our Writer to work with a 3rd party class without needing to change either the Writer or the StringBuilder code.</p>

<p>This Writer pattern can be used with anything that starts from nothing (zero) and can be built up piece by piece (diary). In essence Writer Monad is a sort of immutable, functional Builder pattern.</p>

<p>We  saw that we&rsquo;re not limited to the monads Scala comes packaged with. We  can
use our own monads to define computational contexts to suit our  code&rsquo;s unique
needs.</p>

<h2>Writer Monad Materials</h2>

<ul>
<li><a href="http://learnyouahaskell.com/for-a-few-monads-more#writer">Learn You a Haskell for Great Good</a></li>
<li><a href="http://scalaz.github.com/scalaz/scalaz-2.9.0-1-6.0/doc.sxr/scalaz/Writer.scala.html">Scalaz Writer</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Alex Baranosky -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lispplusplus';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
